# 对接公众号 H5 授权

通过对接微信公众号授权，用户可以在我们的应用中使用微信账号登录，提升用户体验和便利。按照微信官方文档提供的内容，自己研究琢磨比较复杂，需要花一点时间摸索，测试的时候一定会遇到一些问题，这里记录一下，也希望能帮到正在对接的你。

## 准备工作：

1. 创建公众号：在[微信公众平台](https://open.weixin.qq.com/)创建一个公众号，并获取 AppID 和 AppSecret。
2. 前后端都使用 https 协议，因为微信的安全机制，跳转的 h5 页面必须使用 https 协议，所以避免请求失败，后端也要使用 https 协议。
3. 如果之前公众号没有对接过授权，有自动回复或自定义菜单，请注意备份这些信息，由于开启服务端配置后自动回复和自定义菜单会被关闭，自定义菜单可以手动回复，但自动回复需要后端开发自行实现。

## 步骤：

### 步骤 1:

按照文档要求开发后端与前端授权相关的接口与页面。

前端授权有两种触发方式，一种是直接重定向，另一种是按钮触发重定向。<br/>
后端授权

### 步骤 2:

开发完成后，测试流程是否打通是很重要的环节，而网上教程少有提及。需要注意的是，你无法在部署完前端网页后直接调取后台接口，因为这个请求并不是直接通向你的后台，而是先通向微信后台，再由微信后台做二次转发。这个[测试公众号](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)是微信官方提供的工具（不信任我提供的链接可以自行搜索关键字），你可以在里面测试你的公众号授权功能。
我用了 frp 代理，将本地服务器的 https 端口映射到公网，然后使用微信测试号扫码登录。

### 步骤 3:

在公众号后台设置中，开启服务端配置，并配置回调地址。
